Create Table Post(
 ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_Post PRIMARY Key,
 Title Varchar2(255),
 detailes Varchar2(255),
 createAt Date,
 user_id Number Constraint Fk_Post_User REFERENCES User1(ID) on DELETE CASCADE
);

CREATE OR REPLACE PACKAGE  POST_PACKAGE AS

    PROCEDURE POST_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_Title IN VARCHAR DEFAULT NULL
    ,P_detailes IN VARCHAR DEFAULT NULL
    ,P_createAt IN DATE DEFAULT NULL
    ,P_user_id IN NUMBER DEFAULT NULL
    );

End POST_PACKAGE;



CREATE OR REPLACE PACKAGE BODY POST_PACKAGE AS
    
    PROCEDURE POST_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_Title IN VARCHAR DEFAULT NULL
    ,P_detailes IN VARCHAR DEFAULT NULL
    ,P_createAt IN DATE DEFAULT NULL
    ,P_user_id IN NUMBER DEFAULT NULL
    )
    IS
        post_all SYS_REFCURSOR;
    BEGIN
        IF P_ACTION = 'INSERT' THEN
            INSERT INTO POST VALUES(DEFAULT,P_Title,P_detailes,TO_Date(P_createAt , 'dd-mm-yyyy'),P_user_id); 
            COMMIT;
        ELSIF P_ACTION = 'UPDATE' THEN

            UPDATE POST SET
                TITLE = P_Title ,
                DETAILES = P_detailes,
                CREATEAT = TO_Date(P_createAt , 'dd-mm-yyyy'),
                USER_ID = P_user_id 
            WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'DELETE' THEN
            DELETE POST WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'GETALL' THEN
            OPEN post_all FOR SELECT * FROM POST;
            dbms_sql.return_result(post_all);

        ELSIF P_ACTION = 'GETBYID' THEN
            OPEN post_all FOR SELECT * FROM POST WHERE ID = P_ID;
            dbms_sql.return_result(post_all);
        END IF;
    END POST_CRUD;

    
    
END POST_PACKAGE;