Create Table FRIEND(
 ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_FRIEND PRIMARY Key,
 CREATEAT DATE,
 APPROVED NUMBER(1) DEFAULT 0,
 BLOCKUSER NUMBER(1) DEFAULT 0,
 TOUSER NUMBER CONSTRAINT KF_TOUSER_USER1 REFERENCES USER1(ID) ON DELETE CASCADE,
 FROMUSER NUMBER CONSTRAINT KF_FROMUSER_USER1 REFERENCES USER1(ID) ON DELETE CASCADE
);

CREATE OR REPLACE PACKAGE  FRIEND_PACKAGE AS

    PROCEDURE FRIEND_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_CREATEAT IN DATE DEFAULT NULL
    ,P_APPROVED IN NUMBER DEFAULT NULL
    ,P_BLOCKUSER IN NUMBER DEFAULT NULL
    ,P_TOUSER IN NUMBER DEFAULT NULL
    ,P_FROMUSER IN NUMBER DEFAULT NULL
    );
    
End FRIEND_PACKAGE;



CREATE OR REPLACE PACKAGE BODY FRIEND_PACKAGE AS
    
    PROCEDURE FRIEND_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_CREATEAT IN DATE DEFAULT NULL
    ,P_APPROVED IN NUMBER DEFAULT NULL
    ,P_BLOCKUSER IN NUMBER DEFAULT NULL
    ,P_TOUSER IN NUMBER DEFAULT NULL
    ,P_FROMUSER IN NUMBER DEFAULT NULL
    )
    IS
        friend_all SYS_REFCURSOR;
    BEGIN
        IF P_ACTION = 'INSERT' THEN
            INSERT INTO FRIEND VALUES(DEFAULT,To_Date(P_CREATEAT,'dd-mm-yyyy'),P_APPROVED,P_BLOCKUSER,P_TOUSER,P_FROMUSER); 
            COMMIT;
        ELSIF P_ACTION = 'UPDATE' THEN

            UPDATE FRIEND SET
                CREATEAT = To_Date(P_CREATEAT,'dd-mm-yyyy'),
                APPROVED = P_APPROVED , BLOCKUSER = P_BLOCKUSER,
                TOUSER = P_TOUSER , FROMUSER = P_FROMUSER
            WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'DELETE' THEN
            DELETE FRIEND WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'GETALL' THEN
            OPEN friend_all FOR SELECT * FROM FRIEND;
            dbms_sql.return_result(friend_all);

        ELSIF P_ACTION = 'GETBYID' THEN
            OPEN friend_all FOR SELECT * FROM FRIEND WHERE ID = P_ID;
            dbms_sql.return_result(friend_all);  
        END IF;
    END FRIEND_CRUD;

END FRIEND_PACKAGE;