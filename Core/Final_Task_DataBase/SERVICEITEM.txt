create table ServiceItem(
ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_ServiceItem PRIMARY Key,
CreateAt Date,
user_id number Constraint FK_ServiceItem_USER1 REFERENCES USER1(ID) on DElete CASCADE,
servbuy_id number Constraint FK_ServiceBuy_ServiceItem REFERENCES ServiceBuy(ID) on DElete CASCADE,
visa_id number Constraint FK_visa_ServiceItem REFERENCES VISACARD(ID) on DElete CASCADE
);

CREATE OR REPLACE PACKAGE  ServiceItem_PACKAGE AS

    PROCEDURE ServiceItem_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_CreateAt IN DATE DEFAULT NULL
    ,P_user_id IN NUMBER DEFAULT NULL
    ,P_servbuy_id IN NUMBER DEFAULT NULL
    ,P_visa_id IN NUMBER DEFAULT NULL);
    
End ServiceItem_PACKAGE;



CREATE OR REPLACE PACKAGE BODY ServiceItem_PACKAGE AS
    
    PROCEDURE ServiceItem_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_CreateAt IN DATE DEFAULT NULL
    ,P_user_id IN NUMBER DEFAULT NULL
    ,P_servbuy_id IN NUMBER DEFAULT NULL
    ,P_visa_id IN NUMBER DEFAULT NULL)
    IS
        serve_all SYS_REFCURSOR;
    BEGIN
        IF P_ACTION = 'INSERT' THEN
            INSERT INTO SERVICEITEM VALUES(DEFAULT,TO_Date(P_CreateAt , 'dd-mm-yyyy'),P_user_id,P_servbuy_id,P_visa_id); 
            COMMIT;
        ELSIF P_ACTION = 'UPDATE' THEN

            UPDATE SERVICEITEM SET
                CREATEAT = TO_Date(P_CreateAt , 'dd-mm-yyyy') , 
                USER_ID = P_user_id,
                SERVBUY_ID = P_servbuy_id,
                VISA_ID = P_visa_id
            WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'DELETE' THEN
            DELETE SERVICEITEM WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'GETALL' THEN
            OPEN serve_all FOR SELECT * FROM SERVICEITEM;
            dbms_sql.return_result(serve_all);

        ELSIF P_ACTION = 'GETBYID' THEN
            OPEN serve_all FOR SELECT * FROM SERVICEITEM WHERE ID = P_ID;
            dbms_sql.return_result(serve_all);
        END IF;
    END ServiceItem_CRUD;

END ServiceItem_PACKAGE;